<!Doctype html>
<html lang="en-US" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>消息管理</title>
    <link rel="shortcut icon" href="favicon.ico" />
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/normalize.css" />
    <link rel="stylesheet" href="css/common.css">
    <style>
        body {
            background-color: #fafafa;
            font-family: 'Microsoft yahei';
        }

        .container {
            margin-top: 10px;
        }

        h1 {
            padding-bottom: 0px;
        }
        .row{margin-top:-90px;}

        .manageTitle {
            display: flex;
            justify-content: center;
        }

        .footer {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <div class="page-header title">
        <h1>不洗碗工作室日常新闻管理</h1>
    </div>
    <div class="container app">
        <div class="row">
            <div class="col-sm-6 col-sm-offset-3">

                <div class="addel">
                    <div class="form-group target">
                        <div class="input-group">
                            <!--文章标题-->
                            <input type="text" name="contacts[]" class="form-control" value="">

                            <span class="input-group-btn">
                                    <!--编辑修改文章-->
                                <button type="button" class="btn btn-default" aria-label="Left Align">
                                      <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                                </button>
                                    <!--删除文章-->
                                <button type="button" class="btn btn-danger addel-delete">
                                    <i class="fa fa-remove"></i>
                                </button>
                            </span>
                        </div>
                    </div>

                    <div class="form-group target">
                        <div class="input-group">
                            <input type="text" name="contacts[]" class="form-control" id="abc" value="">
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" aria-label="Left Align">
                                  <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn btn-danger addel-delete">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                        </div>
                    </div>

                    <div class="form-group target">
                        <div class="input-group">
                            <input type="text" name="contacts[]" class="form-control" value="">
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" aria-label="Left Align">
                                  <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn btn-danger addel-delete">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                        </div>
                    </div>

                    <div class="form-group target">
                        <div class="input-group">
                            <input type="text" name="contacts[]" class="form-control" value="">
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" aria-label="Left Align">
                                  <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn btn-danger addel-delete">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                        </div>
                    </div>

                    <div class="form-group target">
                        <div class="input-group">
                            <input type="text" name="contacts[]" class="form-control" value="">
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" aria-label="Left Align">
                                  <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn btn-danger addel-delete">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                        </div>
                    </div>

                    <div class="form-group target">
                        <div class="input-group">
                            <input type="text" name="contacts[]" class="form-control" value="">
                            <span class="input-group-btn">
                            <button type="button" class="btn btn-default" aria-label="Left Align">
                                  <i class="glyphicon glyphicon-pencil" aria-hidden="true"></i>
                            </button>
                            <button type="button" class="btn btn-danger addel-delete">
                                <i class="fa fa-remove"></i>
                            </button>
                        </span>
                        </div>
                    </div>
                    <!--添加文章-->
                    <button type="button" class="btn btn-success btn-block addel-add"><i class="fa fa-plus"></i></button>
                    <!--/页脚-->
                    <nav aria-label="Page navigation" class="footer">
                        <ul class="pagination">
                            <li>
                                <a href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                </a>
                            </li>
                            <li><a class="pageN" href="#">1</a></li>
                            <li><a class="pageN" href="#">2</a></li>
                            <li><a class="pageN" href="#">3</a></li>
                            <li><a class="pageN" href="#">4</a></li>
                            <li><a class="pageN" href="#">5</a></li>
                            <li>
                                <a href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>
    <script src="js/jquery-1.12.3.min.js"></script>
    <script src="js/addel.jquery.js"></script>
    <script>
  $(document).ready(function () {
    $('.addel').addel({
      classes: {
        target: 'target'
      },
      animation: {
        duration: 300
      }
    }).on('addel:delete', function (event) {
      if (!window.confirm('删除: ' + '"' + event.target.find(':input').val() + '"?')) {
        event.preventDefault()
      }
    })

    //打来页面自动刷新数据（就是自动获取没默认设置page=0页面的size=6个文章标题）
    var strContent = encodeURI($(".form-group").html());
    var strNumber = encodeURI($(".form-group").size);
    var pageA = $(".pageN");
    $.ajax({
      type:"GET",
      url:"http://hrsoft.net/posts?page=0"+"&size=6",
      dataType: "json",
      data:{ posts: strContent , count: strNumber},
      success: function(json){
        var strTitle = '';
        var strID = '';
        var aTitle = $('.form-control');
        var addel_delete =  $('.addel-delete');
        var glyphicon_pencil =  $('.glyphicon-pencil');
//        window.localStorage.getItem("deleteTitle",aTitle);
        for(var i=0;i < json.data.posts.length;i++){
          (function (i) {
            strTitle = json.data.posts[i].title;
            strID = json.data.posts[i].id;
            aTitle.eq(i).attr("id",strID);  //获取文章列表的核心+删除的是文章id，故加上
            aTitle.eq(i).attr("value",strTitle).text(strTitle);


//                删除
                addel_delete.eq(i).click(function () {
                  var token = window.localStorage.getItem('token')
                  var post_ID = aTitle.eq(i).attr('id')
                  $.ajax({
                    type:'GET',
                    url:"http://hrsoft.net/posts/"+post_ID+"/delete",
                    headers:{
                      'token':token
                    },
                    beforeSend: function (request) {
                      request.setRequestHeader('token', token)
                    },
                    dataType: 'JSON',
                    success: function(){
                      console.log("删除成功!")
                      alert()
                      aTitle.eq(i).remove('value')
                      window.location.reload()
                    }
                  })
                  return false
                })
//              修改
                glyphicon_pencil.eq(i).click(function () {
                  var token = window.localStorage.getItem('token')
                  var post_ID = aTitle.eq(i).attr('id')
                  localStorage.setItem('list', post_ID);
                  window.location.href = 'markdown.html?edit';
            })
          })(i)
        }
      }
    })

//    点击每一页码之后本地获取的6篇文章信息，页数是使用者点击的页码数
    for(var i=0;i<pageA.length;i++){
      (function (i) {
//             点击每个分页请求的数据不同
        pageA.eq(i).click(function(){
          window.localStorage.setItem("page", pageA.eq(i).html()-1)

          var page = window.localStorage.getItem('page')

          //手动点击选择页码
          $.ajax({
            type:"GET",
            url:"http://hrsoft.net/posts?page="+page+"&size=6",
            dataType: "json",
            data:{ posts: strContent , count: strNumber},
            success: function(json){
              var strTitle = '';
              var strID = '';
              var aTitle = $('.form-control');
              var addel_delete =  $('.addel-delete');
              var glyphicon_pencil =  $('.glyphicon-pencil');
//             function retHTML(){
//               var str = '<a href="#" class="list-group-item">Dapibus ac facilisis in</a>';
//               return str;
//             }

              for(var i=0;i < json.data.posts.length;i++){
                (function (i) {
//                       console.log(json.data.posts[i]);
                  strTitle = json.data.posts[i].title;
                  strID = json.data.posts[i].id;
                  aTitle.eq(i).attr("value",strTitle).text(strTitle);
                  aTitle.eq(i).attr("id",strID).text(strTitle);
//                 $('.app').append(retHTML);

//                删除
                  addel_delete.eq(i).click(function () {
                    var token = window.localStorage.getItem('token')
                    var post_ID = aTitle.eq(i).attr('id')
                    $.ajax({
                      type:'GET',
                      url:"http://hrsoft.net/posts/"+post_ID+"/delete",
                      headers:{
                        'token':token
                      },
                      beforeSend: function (request) {
                        request.setRequestHeader('token', token)
                      },
                      dataType: 'JSON',
                      success: function(){
                        console.log("删除成功!")
                        aTitle.eq(i).remove('value')
                        window.location.reload()
                      }
                    })
                    return false
                  })
                  //修改
                  glyphicon_pencil.eq(i).click(function () {
                    var token = window.localStorage.getItem('token')
                    var post_ID = aTitle.eq(i).attr('id')
                    localStorage.setItem('list', post_ID);
                    window.location.href = 'markdown.html?edit';
                  })
                })(i)
              }
            }
          })
        })
      })(i)
    }

    //创建新文章
    $('.addel-add').click(function () {
        var token = window.localStorage.getItem('token');
        window.location.href = 'markdown.html';
        })
  })
</script>
</body>
</html>

